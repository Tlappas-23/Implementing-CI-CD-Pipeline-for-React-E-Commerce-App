<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebase Debug</title>
  <style>
    body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #00ff00; }
    .error { color: #ff4444; }
    .success { color: #44ff44; }
    .info { color: #4444ff; }
    pre { background: #000; padding: 10px; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>üîç Firebase Configuration Debug</h1>
  <div id="output"></div>

  <script type="module">
    const output = document.getElementById('output');

    function log(msg, type = 'info') {
      const div = document.createElement('div');
      div.className = type;
      div.textContent = msg;
      output.appendChild(div);
    }

    function logObj(label, obj) {
      log(label + ':', 'info');
      const pre = document.createElement('pre');
      pre.textContent = JSON.stringify(obj, null, 2);
      output.appendChild(pre);
    }

    // Check if Firebase env vars are defined
    const config = {
      apiKey: import.meta.env.VITE_FIREBASE_API_KEY,
      authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN,
      projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,
      storageBucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET,
      messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID,
      appId: import.meta.env.VITE_FIREBASE_APP_ID
    };

    log('=== Environment Variables Check ===', 'info');
    logObj('Firebase Config', config);

    const allDefined = Object.values(config).every(v => v !== undefined && v !== '');

    if (!allDefined) {
      log('‚ùå PROBLEM: Some Firebase env vars are undefined!', 'error');
      Object.entries(config).forEach(([key, value]) => {
        if (!value) {
          log(`  Missing: ${key}`, 'error');
        }
      });
    } else {
      log('‚úÖ All Firebase env vars are defined', 'success');
    }

    // Try to initialize Firebase
    try {
      log('\n=== Attempting Firebase Initialization ===', 'info');

      const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
      const { getFirestore, collection, getDocs } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');

      const app = initializeApp(config);
      log('‚úÖ Firebase app initialized', 'success');

      const db = getFirestore(app);
      log('‚úÖ Firestore instance created', 'success');

      log('\n=== Fetching Products ===', 'info');
      const productsRef = collection(db, 'products');

      const startTime = Date.now();
      const snapshot = await getDocs(productsRef);
      const duration = Date.now() - startTime;

      log(`‚úÖ Query completed in ${duration}ms`, 'success');
      log(`üì¶ Found ${snapshot.size} products`, 'success');

      if (snapshot.size > 0) {
        log('\nFirst 5 products:', 'info');
        snapshot.docs.slice(0, 5).forEach((doc, i) => {
          const data = doc.data();
          log(`  ${i + 1}. ${data.title} - $${data.price}`, 'success');
        });
      }

    } catch (error) {
      log('\n‚ùå ERROR OCCURRED', 'error');
      log(`Code: ${error.code}`, 'error');
      log(`Message: ${error.message}`, 'error');
      logObj('Full Error', {
        code: error.code,
        message: error.message,
        stack: error.stack
      });

      if (error.code === 'permission-denied') {
        log('\nüî• FIRESTORE SECURITY RULES ARE BLOCKING!', 'error');
        log('Fix: Update Firestore rules to allow read: if true for products', 'error');
      }
    }
  </script>
</body>
</html>
